<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Novo Serviço</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="cadastroServico.css">
</head>

<body>

    <main class="card">

        <!-- PAINEL ESQUERDO – CADASTRAR -->
        <div class="panel register">
            <h1>Cadastrar Serviço</h1>

            <form class="service-form">

                <label for="nome">Nome do Serviço</label>
                <input type="text" id="nome" placeholder="Ex: Corte Feminino" required>

                <label for="descricao">Descrição</label>
                <textarea id="descricao" placeholder="Descreva o serviço..." required></textarea>

                <label for="duracao">Duração (minutos)</label>
                <input type="number" id="duracao" placeholder="Ex: 45" required>

                <label for="valor">Valor (R$)</label>
                <input type="number" id="valor" placeholder="Ex: 120.00" step="0.01" required>

                <button type="submit" class="btn primary">Salvar Serviço</button>

            </form>
        </div>

        <!-- DIVISÓRIA -->
        <div class="divider"></div>

        <!-- PAINEL DIREITO – CONSULTAR -->
        <div class="panel consult">
            <h1>Consultar Serviço</h1>

            <label>Pesquisar serviço:</label>

            <div class="searchwrap">
                <input id="pesquisa-serv" type="search" placeholder="Digite nome ou valor...">
            </div>

            <div id="resultados-serv"></div>
        </div>

    </main>

    <!-- SALVAR NO JSON SERVER -->
    <script>
        const form = document.querySelector(".service-form");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const nome = document.getElementById("nome").value;
            const descricao = document.getElementById("descricao").value;
            const duracao = document.getElementById("duracao").value;
            const valor = document.getElementById("valor").value;

            const resposta = await fetch("http://localhost:3000/servicos", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    nome,
                    descricao,
                    duracao,
                    valor
                })
            });

            await resposta.json();
            alert("Serviço cadastrado com sucesso!");
        });
    </script>

    <!-- CONSULTAR SERVIÇOS COM ENTER -->
    <script>
        const pesquisaServ = document.getElementById("pesquisa-serv");
        const resultadosServ = document.getElementById("resultados-serv");

        pesquisaServ.addEventListener("keydown", async (event) => {

            if (event.key !== "Enter") return;
            event.preventDefault();

            const termo = pesquisaServ.value.toLowerCase().trim();

            if (!termo) {
                resultadosServ.innerHTML = "<p>Digite algo para pesquisar.</p>";
                return;
            }

            const resposta = await fetch("http://localhost:3000/servicos");
            const servicos = await resposta.json();

            const filtrados = servicos.filter(s =>
                s.nome.toLowerCase().includes(termo) ||
                s.valor.toString().includes(termo)
            );

            if (filtrados.length === 0) {
                resultadosServ.innerHTML = "<p><strong>Não há nenhum serviço com esse nome.</strong></p>";
                return;
            }

            resultadosServ.innerHTML = filtrados.map(s => `
                <div class="resultado-item">
                    <p><strong>Nome:</strong> ${s.nome}</p>
                    <p><strong>Descrição:</strong> ${s.descricao}</p>
                    <p><strong>Duração:</strong> ${s.duracao} min</p>
                    <p><strong>Valor:</strong> R$ ${s.valor}</p>
                    <hr>
                </div>
            `).join("");
        });
    </script>

</body>

</html>
