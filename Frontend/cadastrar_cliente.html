<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cadastro / Consulta de Cliente</title>

    <!-- FONTES -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Quicksand:wght@300;400;600&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="cadastrar_cliente.css" />
</head>

<body>
    <main class="card">

        <!-- PAINEL ESQUERDO -->
        <div class="panel register">
            <h1>Cadastrar cliente</h1>

            <form class="form">
                <label class="label">Nome:</label>
                <input type="text" id="nome" placeholder="Digite o nome">

                <label class="label">Email:</label>
                <input type="email" id="email" placeholder="usuario@exemplo.com">

                <label class="label">Data de nascimento:</label>
                <input type="date" id="nascimento">

                <label class="label">Observações:</label>
                <textarea id="observacoes" rows="4" placeholder="Anotações sobre o cliente..."></textarea>

                <div class="actions">
                    <button class="btn primary">Salvar</button>
                    <button class="btn ghost" type="button">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- DIVISÓRIA -->
        <div class="divider"></div>

        <!-- PAINEL DIREITO: CONSULTA -->
        <div class="panel consult">
            <h1>Consultar cliente</h1>

            <label class="label">Digite o nome do cliente:</label>

            <div class="searchwrap">
                <input id="pesquisa" type="search" placeholder="Digite aqui...">
            </div>

            <div id="resultados"></div>
        </div>
    </main>

    <!-- SCRIPT SALVAR CLIENTE -->
    <script>
        const form = document.querySelector(".form");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const nome = document.getElementById("nome").value;
            const email = document.getElementById("email").value;
            const dataNascimento = document.getElementById("nascimento").value;
            const observacoes = document.getElementById("observacoes").value;

            const resposta = await fetch("http://localhost:3000/clientes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    nome,
                    email,
                    dataNascimento,
                    observacoes
                })
            });

            await resposta.json();
            alert("Cliente cadastrado com sucesso!");
            form.reset();
        });
    </script>

    <!-- SCRIPT PESQUISA COM ENTER -->
    <script>
        const campoPesquisa = document.getElementById("pesquisa");
        const resultadosDiv = document.getElementById("resultados");

        campoPesquisa.addEventListener("keydown", async (event) => {

            if (event.key !== "Enter") return;
            event.preventDefault();

            const termo = campoPesquisa.value.toLowerCase().trim();

            if (!termo) {
                resultadosDiv.innerHTML = "<p>Digite algo para pesquisar.</p>";
                return;
            }

            const resposta = await fetch("http://localhost:3000/clientes");
            const clientes = await resposta.json();

            const filtrados = clientes.filter(c =>
                c.nome.toLowerCase().includes(termo)
            );

            if (filtrados.length === 0) {
                resultadosDiv.innerHTML = "<p><strong>Nenhum cliente encontrado.</strong></p>";
                return;
            }

            resultadosDiv.innerHTML = filtrados.map(c => `
                <div class="resultado-item">
                    <p><strong>Nome:</strong> ${c.nome}</p>
                    <p><strong>Email:</strong> ${c.email}</p>
                    <p><strong>Nascimento:</strong> ${c.dataNascimento}</p>
                    <p><strong>Obs:</strong> ${c.observacoes}</p>
                    <hr>
                </div>
            `).join("");
        });
    </script>

</body>

</html>
